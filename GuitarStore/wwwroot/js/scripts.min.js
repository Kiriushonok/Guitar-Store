document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("filter-form"),n=document.querySelectorAll(".product-card-box"),r=[{element:n[0],name:"Yamaha F310",price:25e3,type:"acoustic",brand:"yamaha"},{element:n[1],name:"Fender Stratocaster",price:12e4,type:"electric",brand:"fender"},{element:n[2],name:"Ibanez GSR200",price:8e4,type:"bass",brand:"ibanez"},{element:n[3],name:"Gibson Les Paul",price:14e4,type:"electric",brand:"gibson"},{element:n[4],name:"Fender Precision Bass",price:9e4,type:"bass",brand:"fender"},{element:n[5],name:"Gibson Les Paul Standard",price:15e4,type:"electric",brand:"gibson"}];t.addEventListener("submit",n=>{n.preventDefault();const f=t["guitar-type"].value;let i=parseInt(t["price-min"].value),u=parseInt(t["price-max"].value);const e=t.brand.value;if(isNaN(i)&&(i=0),isNaN(u)&&(u=Infinity),i>u){alert("Некорректные фильтры по цене: минимальная цена больше максимальной.");return}r.forEach(n=>{const t=f===""||n.type===f,r=n.price>=i&&n.price<=u,o=e===""||n.brand===e;n.element.style.display=t&&r&&o?"block":"none"})});const i=document.getElementById("back-to-top");window.addEventListener("scroll",()=>{i.style.display=window.scrollY>300?"block":"none"});i.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.getElementById("service-form").addEventListener("submit",function(n){n.preventDefault();let t=!0;const f=document.getElementById("guitar-brand").value.trim(),e=document.getElementById("guitar-type").value.trim(),o=document.getElementById("guitar-model").value.trim(),i=document.getElementById("year").value.trim(),r=document.getElementById("price").value.trim(),u=document.getElementById("guitar-photo").files[0];document.querySelectorAll(".error").forEach(n=>n.textContent="");document.getElementById("success-message").textContent="";f||(document.getElementById("guitar-brand-error").textContent="Введите бренд гитары.",t=!1);e||(document.getElementById("guitar-type-error").textContent="Введите тип гитары.",t=!1);o||(document.getElementById("guitar-model-error").textContent="Введите модель гитары.",t=!1);const s=(new Date).getFullYear();(!/^\d{4}$/.test(i)||i<2e3||i>s)&&(document.getElementById("year-error").textContent="Год выпуска должен быть в диапазоне от 2000 до текущего года.",t=!1);(!/^\d+$/.test(r)||r<=0)&&(document.getElementById("price-error").textContent="Введите корректную цену в рублях.",t=!1);u?["image/jpeg","image/png"].includes(u.type)||(document.getElementById("guitar-photo-error").textContent="Фото должно быть в формате .jpg или .png.",t=!1):(document.getElementById("guitar-photo-error").textContent="Прикрепите фото гитары.",t=!1);t&&(document.getElementById("success-message").textContent="Гитара успешно добавлена!",this.reset())});document.addEventListener("DOMContentLoaded",()=>{function s(t){n.forEach(n=>n.classList.remove("active"));n[t]&&n[t].classList.add("active")}function c(n){n.classList.remove("active")}function l(n){n.classList.add("active")}function f(n){fetch(`/Guitars/GetGuitarImage?guitarId=${h}&index=${n}`).then(n=>{if(!n.ok)throw new Error("Image not found");return n.json()}).then(t=>{c(r),setTimeout(()=>{r.src=t.imageUrl,i=n,l(r),s(n)},250)}).catch(n=>console.error("������ ��� �������� �����������:",n))}const e=document.querySelector(".prev-btn"),o=document.querySelector(".next-btn"),r=document.getElementById("carousel-image"),u=document.querySelector(".carousel-images");if(u){const n=document.querySelectorAll(".carousel-dot");n.forEach(n=>{n.addEventListener("click",n=>{const t=parseInt(n.target.dataset.index);t!==i&&f(t)})});const t=parseInt(u.dataset.total),h=u.dataset.guitarId;let i=0;t>1&&(e.style.display="block",o.style.display="block");o.addEventListener("click",()=>{const n=(i+1)%t;f(n)});e.addEventListener("click",()=>{const n=(i-1+t)%t;f(n)})}});document.addEventListener("DOMContentLoaded",()=>{function v(n,t){let i=Math.max(1,Math.round((t-n)/100));while((t-n)%i!=0&&i>1)i--;return i}function d(n,i,r){const e=(n-r)/i,f=Math.round(e)*i+r;return Math.abs(f-t)<i/2?t:Math.abs(f-u)<i/2?u:Math.min(u,Math.max(t,f))}function nt(){const f=parseInt(n.value),o=v(t,u),s=t,h=Math.min(f,parseInt(r.value)),i=d(h,o,s);n.value!=i&&(n.value=i);c.value=i;ot.textContent=`от ${i}`;y();e()}function tt(){const f=parseInt(r.value),o=v(t,u),s=t,h=Math.max(f,parseInt(n.value)),i=d(h,o,s);r.value!=i&&(r.value=i);l.value=i;st.textContent=`до ${i}`;y();e()}function it(){let i=parseInt(c.value),e=parseInt(l.value);if(isNaN(i)&&(i=t),isNaN(e)&&(e=u),i=Math.max(t,Math.min(u,i)),e=Math.max(t,Math.min(u,e)),i>e){f.style.display="block";return}f.style.display="none";n.value=i;r.value=e;y()}function y(){const t=parseInt(n.min),i=parseInt(n.max),e=parseInt(n.value),o=parseInt(r.value),u=(e-t)/(i-t)*100,s=(o-t)/(i-t)*100,f=document.querySelector(".slider-track");f.style.left=`${u}%`;f.style.width=`${s-u}%`}function e(){const n=parseFloat(c.value),t=parseFloat(l.value);return!isNaN(n)&&!isNaN(t)&&n>t?(f.style.display="block",!1):(f.style.display="none",!0)}async function o(){const n=new URLSearchParams(new FormData(s));n.append("page",i);n.append("pageSize",rt);const r=await fetch(`/Guitars/GetFilteredGuitars?${n.toString()}`),t=await r.json();ft.textContent=`Найдено гитар: ${t.totalItems}`;ht(t.items);ct(t.totalPages)}function ht(n){if(h.innerHTML="",n.length===0){h.innerHTML="<p>Ничего не найдено.<\/p>";return}n.forEach(n=>{const t=document.createElement("a");t.href=`/Guitars/Show/${n.id}`;t.className="product-card-box";const i=n.guitarImageFileNames&&n.guitarImageFileNames.length>0,r=i?`<img src="/img/${n.guitarImageFileNames[0]}" 
                       alt="${n.guitarBrand} ${n.guitarModel}" 
                       class="product-card-image" />`:`<div class="no-image-placeholder">Пока нет фотографий гитары ${n.guitarBrand} ${n.guitarModel}</div>`;t.innerHTML=`
                ${r}
                <div class="product-card-info">
                    <div>${n.guitarBrand} ${n.guitarModel}</div>
                    <strong>${n.guitarPrice.toLocaleString()} ₽</strong>
                    <p>Тип: ${n.guitarType}</p>
                    <p>Бренд: ${n.guitarBrand}</p>
                </div>`;h.appendChild(t)})}function ct(n){n<=1?k.style.display="none":(k.style.display="flex",ut.textContent=i,w.disabled=i===1,b.disabled=i===n,w.onclick=()=>{i>1&&(i--,o())},b.onclick=()=>{i<n&&(i++,o())})}const s=document.getElementById("filter-form"),h=document.getElementById("catalog-container"),w=document.getElementById("prev-page-btn"),b=document.getElementById("next-page-btn"),ut=document.getElementById("current-page"),k=document.querySelector(".pagination"),c=document.getElementById("priceMin"),l=document.getElementById("priceMax"),ft=document.getElementById("guitar-count"),et=document.getElementById("reset-filters"),a=document.getElementById("page-size-select"),n=document.getElementById("price-slider-min"),r=document.getElementById("price-slider-max"),ot=document.getElementById("range-min-label"),st=document.getElementById("range-max-label"),t=parseInt(n.min),u=parseInt(r.max);const g=v(t,u);n.step=g;r.step=g;const f=document.createElement("p");f.style.color="red";f.style.marginTop="0px";f.style.display="none";f.textContent="Минимальная цена не может быть больше максимальной!";s.insertBefore(f,s.querySelector("button, input[type='submit']"));n.addEventListener("input",nt);r.addEventListener("input",tt);c.addEventListener("input",()=>{it(),e()});l.addEventListener("input",()=>{it(),e()});let i=1,rt=parseInt(a.value);a.addEventListener("change",()=>{rt=parseInt(a.value),i=1,o()});et.addEventListener("click",()=>{s.reset(),n.value=t,r.value=u,nt(),tt(),i=1,o(),e()});s.addEventListener("submit",n=>{(n.preventDefault(),e())&&(i=1,o())});h.addEventListener("mouseover",n=>{const t=n.target.closest(".product-card-box");t&&(t.style.transform="scale(1.05)",t.style.boxShadow="0 6px 20px rgba(0, 0, 0, 0.2)",t.style.backgroundColor="rgba(0, 0, 0, 0.05)")});h.addEventListener("mouseout",n=>{const t=n.target.closest(".product-card-box");t&&(t.style.transform="scale(1)",t.style.boxShadow="",t.style.backgroundColor="")});const p=document.getElementById("back-to-top");p&&(window.addEventListener("scroll",()=>{p.style.display=window.scrollY>300?"block":"none"}),p.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}));o()});