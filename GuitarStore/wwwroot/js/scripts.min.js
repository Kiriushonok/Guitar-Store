document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("filter-form"),n=document.querySelectorAll(".product-card-box"),r=[{element:n[0],name:"Yamaha F310",price:25e3,type:"acoustic",brand:"yamaha"},{element:n[1],name:"Fender Stratocaster",price:12e4,type:"electric",brand:"fender"},{element:n[2],name:"Ibanez GSR200",price:8e4,type:"bass",brand:"ibanez"},{element:n[3],name:"Gibson Les Paul",price:14e4,type:"electric",brand:"gibson"},{element:n[4],name:"Fender Precision Bass",price:9e4,type:"bass",brand:"fender"},{element:n[5],name:"Gibson Les Paul Standard",price:15e4,type:"electric",brand:"gibson"}];t.addEventListener("submit",n=>{n.preventDefault();const f=t["guitar-type"].value;let i=parseInt(t["price-min"].value),u=parseInt(t["price-max"].value);const e=t.brand.value;if(isNaN(i)&&(i=0),isNaN(u)&&(u=Infinity),i>u){alert("Некорректные фильтры по цене: минимальная цена больше максимальной.");return}r.forEach(n=>{const t=f===""||n.type===f,r=n.price>=i&&n.price<=u,o=e===""||n.brand===e;n.element.style.display=t&&r&&o?"block":"none"})});const i=document.getElementById("back-to-top");window.addEventListener("scroll",()=>{i.style.display=window.scrollY>300?"block":"none"});i.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.getElementById("service-form").addEventListener("submit",function(n){n.preventDefault();let t=!0;const f=document.getElementById("guitar-brand").value.trim(),e=document.getElementById("guitar-type").value.trim(),o=document.getElementById("guitar-model").value.trim(),i=document.getElementById("year").value.trim(),r=document.getElementById("price").value.trim(),u=document.getElementById("guitar-photo").files[0];document.querySelectorAll(".error").forEach(n=>n.textContent="");document.getElementById("success-message").textContent="";f||(document.getElementById("guitar-brand-error").textContent="Введите бренд гитары.",t=!1);e||(document.getElementById("guitar-type-error").textContent="Введите тип гитары.",t=!1);o||(document.getElementById("guitar-model-error").textContent="Введите модель гитары.",t=!1);const s=(new Date).getFullYear();(!/^\d{4}$/.test(i)||i<2e3||i>s)&&(document.getElementById("year-error").textContent="Год выпуска должен быть в диапазоне от 2000 до текущего года.",t=!1);(!/^\d+$/.test(r)||r<=0)&&(document.getElementById("price-error").textContent="Введите корректную цену в рублях.",t=!1);u?["image/jpeg","image/png"].includes(u.type)||(document.getElementById("guitar-photo-error").textContent="Фото должно быть в формате .jpg или .png.",t=!1):(document.getElementById("guitar-photo-error").textContent="Прикрепите фото гитары.",t=!1);t&&(document.getElementById("success-message").textContent="Гитара успешно добавлена!",this.reset())});document.addEventListener("DOMContentLoaded",()=>{function s(t){n.forEach(n=>n.classList.remove("active"));n[t]&&n[t].classList.add("active")}function c(n){n.classList.remove("active")}function l(n){n.classList.add("active")}function u(n){fetch(`/Guitars/GetGuitarImage?guitarId=${h}&index=${n}`).then(n=>{if(!n.ok)throw new Error("Image not found");return n.json()}).then(t=>{c(r),setTimeout(()=>{r.src=t.imageUrl,i=n,l(r),s(n)},250)}).catch(n=>console.error("������ ��� �������� �����������:",n))}const f=document.querySelector(".prev-btn"),e=document.querySelector(".next-btn"),r=document.getElementById("carousel-image"),o=document.querySelector(".carousel-images"),n=document.querySelectorAll(".carousel-dot");n.forEach(n=>{n.addEventListener("click",n=>{const t=parseInt(n.target.dataset.index);t!==i&&u(t)})});const t=parseInt(o.dataset.total),h=o.dataset.guitarId;let i=0;t>1&&(f.style.display="block",e.style.display="block");e.addEventListener("click",()=>{const n=(i+1)%t;u(n)});f.addEventListener("click",()=>{const n=(i-1+t)%t;u(n)})});document.addEventListener("DOMContentLoaded",()=>{function rt(n,t){const r=t-n;let i=Math.max(1,Math.round(r/100));while(r%i!=0&&i>1)i--;return i}function w(n,t,r){const u=Math.round((n-r)/t)*t+r;return Math.min(u,parseInt(i.max))}function h(){let t=parseInt(n.value),f=parseInt(i.value);t>f&&(t=f,n.value=t);const e=parseInt(n.getAttribute("step")||"1"),o=parseInt(n.min||"0");r.value=w(t,e,o);u.value=w(f,e,o);tt.textContent=`от ${r.value}`;it.textContent=`до ${u.value}`;ut()}function ut(){const t=parseInt(n.min),r=parseInt(n.max),e=parseInt(n.value),o=parseInt(i.value),u=(e-t)/(r-t)*100,s=(o-t)/(r-t)*100,f=document.querySelector(".slider-track");f.style.left=`${u}%`;f.style.width=`${s-u}%`}function b(){const t=parseInt(r.value),f=parseInt(u.value);isNaN(t)||(n.value=t);isNaN(f)||(i.value=f);h()}function c(){const n=parseFloat(r.value),t=parseFloat(u.value);return!isNaN(n)&&!isNaN(t)&&n>t?(f.style.display="block",!1):(f.style.display="none",!0)}async function e(){const i=new URLSearchParams(new FormData(o));i.append("page",t);i.append("pageSize",k);const r=await fetch(`/Guitars/GetFilteredGuitars?${i.toString()}`),n=await r.json();g.textContent=`Найдено гитар: ${n.totalItems}`;et(n.items);ot(n.totalPages);ft(n.minPrice,n.maxPrice)}function ft(t,f){r.placeholder=`от ${t}`;u.placeholder=`до ${f}`;n.min=t;n.max=f;i.min=t;i.max=f;const e=rt(t,f);n.step=e;i.step=e;r.value||(n.value=t);u.value||(i.value=f);h()}function et(n){if(s.innerHTML="",n.length===0){s.innerHTML="<p>Ничего не найдено.<\/p>";return}n.forEach(n=>{const t=document.createElement("a");t.href=`/Guitars/Show/${n.id}`;t.className="product-card-box";t.innerHTML=`
            <img src="/img/${n.guitarImageFileNames?.[0]}"
                 alt="${n.guitarBrand} ${n.guitarModel}" class="product-card-image" />
            <div class="product-card-info">
                <div>${n.guitarBrand} ${n.guitarModel}</div>
                <strong>${n.guitarPrice.toLocaleString()} ₽</strong>
                <p>Тип: ${n.guitarType}</p>
                <p>Бренд: ${n.guitarBrand}</p>
            </div>
        `;s.appendChild(t)})}function ot(n){n<=1?p.style.display="none":(p.style.display="flex",d.textContent=t,v.disabled=t===1,y.disabled=t===n,v.onclick=()=>{t>1&&(t--,e())},y.onclick=()=>{t<n&&(t++,e())})}const o=document.getElementById("filter-form"),s=document.getElementById("catalog-container"),v=document.getElementById("prev-page-btn"),y=document.getElementById("next-page-btn"),d=document.getElementById("current-page"),p=document.querySelector(".pagination"),r=document.getElementById("priceMin"),u=document.getElementById("priceMax"),g=document.getElementById("guitar-count"),nt=document.getElementById("reset-filters"),l=document.getElementById("page-size-select"),n=document.getElementById("price-slider-min"),i=document.getElementById("price-slider-max"),tt=document.getElementById("range-min-label"),it=document.getElementById("range-max-label");n.addEventListener("input",h);i.addEventListener("input",h);r.addEventListener("input",b);u.addEventListener("input",b);const f=document.createElement("p");f.style.color="red";f.style.marginTop="0px";f.style.display="none";f.textContent="Минимальная цена не может быть больше максимальной!";o.insertBefore(f,o.querySelector("button, input[type='submit']"));r.addEventListener("input",c);u.addEventListener("input",c);let t=1,k=parseInt(l.value);l.addEventListener("change",()=>{k=parseInt(l.value),t=1,e()});nt.addEventListener("click",()=>{o.reset(),t=1,e(),c()});s.addEventListener("mouseover",function(n){const t=n.target.closest(".product-card-box");t&&(t.style.transform="scale(1.05)",t.style.boxShadow="0 6px 20px rgba(0, 0, 0, 0.2)",t.style.backgroundColor="rgba(0, 0, 0, 0.05)")});s.addEventListener("mouseout",function(n){const t=n.target.closest(".product-card-box");t&&(t.style.transform="scale(1)",t.style.boxShadow="",t.style.backgroundColor="")});o.addEventListener("submit",n=>{(n.preventDefault(),c())&&(t=1,e())});const a=document.getElementById("back-to-top");a&&(window.addEventListener("scroll",()=>{a.style.display=window.scrollY>300?"block":"none"}),a.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}));e()});