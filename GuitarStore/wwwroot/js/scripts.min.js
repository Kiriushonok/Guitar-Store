document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("filter-form"),n=document.querySelectorAll(".product-card-box"),r=[{element:n[0],name:"Yamaha F310",price:25e3,type:"acoustic",brand:"yamaha"},{element:n[1],name:"Fender Stratocaster",price:12e4,type:"electric",brand:"fender"},{element:n[2],name:"Ibanez GSR200",price:8e4,type:"bass",brand:"ibanez"},{element:n[3],name:"Gibson Les Paul",price:14e4,type:"electric",brand:"gibson"},{element:n[4],name:"Fender Precision Bass",price:9e4,type:"bass",brand:"fender"},{element:n[5],name:"Gibson Les Paul Standard",price:15e4,type:"electric",brand:"gibson"}];t.addEventListener("submit",n=>{n.preventDefault();const f=t["guitar-type"].value;let i=parseInt(t["price-min"].value),u=parseInt(t["price-max"].value);const e=t.brand.value;if(isNaN(i)&&(i=0),isNaN(u)&&(u=Infinity),i>u){alert("Некорректные фильтры по цене: минимальная цена больше максимальной.");return}r.forEach(n=>{const t=f===""||n.type===f,r=n.price>=i&&n.price<=u,o=e===""||n.brand===e;n.element.style.display=t&&r&&o?"block":"none"})});const i=document.getElementById("back-to-top");window.addEventListener("scroll",()=>{i.style.display=window.scrollY>300?"block":"none"});i.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.getElementById("service-form").addEventListener("submit",function(n){n.preventDefault();let t=!0;const f=document.getElementById("guitar-brand").value.trim(),e=document.getElementById("guitar-type").value.trim(),o=document.getElementById("guitar-model").value.trim(),i=document.getElementById("year").value.trim(),r=document.getElementById("price").value.trim(),u=document.getElementById("guitar-photo").files[0];document.querySelectorAll(".error").forEach(n=>n.textContent="");document.getElementById("success-message").textContent="";f||(document.getElementById("guitar-brand-error").textContent="Введите бренд гитары.",t=!1);e||(document.getElementById("guitar-type-error").textContent="Введите тип гитары.",t=!1);o||(document.getElementById("guitar-model-error").textContent="Введите модель гитары.",t=!1);const s=(new Date).getFullYear();(!/^\d{4}$/.test(i)||i<2e3||i>s)&&(document.getElementById("year-error").textContent="Год выпуска должен быть в диапазоне от 2000 до текущего года.",t=!1);(!/^\d+$/.test(r)||r<=0)&&(document.getElementById("price-error").textContent="Введите корректную цену в рублях.",t=!1);u?["image/jpeg","image/png"].includes(u.type)||(document.getElementById("guitar-photo-error").textContent="Фото должно быть в формате .jpg или .png.",t=!1):(document.getElementById("guitar-photo-error").textContent="Прикрепите фото гитары.",t=!1);t&&(document.getElementById("success-message").textContent="Гитара успешно добавлена!",this.reset())});document.addEventListener("DOMContentLoaded",()=>{function s(t){n.forEach(n=>n.classList.remove("active"));n[t]&&n[t].classList.add("active")}function c(n){n.classList.remove("active")}function l(n){n.classList.add("active")}function f(n){fetch(`/Guitars/GetGuitarImage?guitarId=${h}&index=${n}`).then(n=>{if(!n.ok)throw new Error("Image not found");return n.json()}).then(t=>{c(r),setTimeout(()=>{r.src=t.imageUrl,i=n,l(r),s(n)},250)}).catch(n=>console.error("������ ��� �������� �����������:",n))}const e=document.querySelector(".prev-btn"),o=document.querySelector(".next-btn"),r=document.getElementById("carousel-image"),u=document.querySelector(".carousel-images");if(u){const n=document.querySelectorAll(".carousel-dot");n.forEach(n=>{n.addEventListener("click",n=>{const t=parseInt(n.target.dataset.index);t!==i&&f(t)})});const t=parseInt(u.dataset.total),h=u.dataset.guitarId;let i=0;t>1&&(e.style.display="block",o.style.display="block");o.addEventListener("click",()=>{const n=(i+1)%t;f(n)});e.addEventListener("click",()=>{const n=(i-1+t)%t;f(n)})}});document.addEventListener("DOMContentLoaded",()=>{function at(n){if(!n||n.length===0){f.innerHTML="<p>Ничего не найдено<\/p>";f.style.display="block";return}f.innerHTML=n.map(n=>`
        <div class="live-search-item" onclick="location.href='/Guitars/Show/${n.id}'">
            <img src="/img/${n.image&&n.image.trim()!==""?n.image:"noimage_detail.png"}" alt="${n.brand} ${n.model}" />
            <div class="live-search-item-title">${n.brand} ${n.model}</div>
            <div><strong>${n.price.toLocaleString()} ₽</strong></div>
        </div>
    `).join("");f.style.display="block"}function w(n,t){let i=Math.max(1,Math.round((t-n)/100));while((t-n)%i!=0&&i>1)i--;return i}function tt(n,i,r){const e=(n-r)/i,f=Math.round(e)*i+r;return Math.abs(f-t)<i/2?t:Math.abs(f-u)<i/2?u:Math.min(u,Math.max(t,f))}function rt(){const f=parseInt(n.value),e=w(t,u),s=t,h=Math.min(f,parseInt(r.value)),i=tt(h,e,s);n.value!=i&&(n.value=i);a.value=i;ct.textContent=`от ${i}`;b();o()}function ut(){const f=parseInt(r.value),e=w(t,u),s=t,h=Math.max(f,parseInt(n.value)),i=tt(h,e,s);r.value!=i&&(r.value=i);v.value=i;lt.textContent=`до ${i}`;b();o()}function ft(){let i=parseInt(a.value),f=parseInt(v.value);if(isNaN(i)&&(i=t),isNaN(f)&&(f=u),i=Math.max(t,Math.min(u,i)),f=Math.max(t,Math.min(u,f)),i>f){e.style.display="block";return}e.style.display="none";n.value=i;r.value=f;b()}function b(){const t=parseInt(n.min),i=parseInt(n.max),e=parseInt(n.value),o=parseInt(r.value),u=(e-t)/(i-t)*100,s=(o-t)/(i-t)*100,f=document.querySelector(".slider-track");f.style.left=`${u}%`;f.style.width=`${s-u}%`}function o(){const n=parseFloat(a.value),t=parseFloat(v.value);return!isNaN(n)&&!isNaN(t)&&n>t?(e.style.display="block",!1):(e.style.display="none",!0)}async function s(){const n=new URLSearchParams(new FormData(h));n.append("page",i);n.append("pageSize",et);const r=await fetch(`/Guitars/GetFilteredGuitars?${n.toString()}`),t=await r.json();st.textContent=`Найдено гитар: ${t.totalItems}`;vt(t.items);yt(t.totalPages)}function vt(n){if(c.innerHTML="",n.length===0){c.innerHTML="<p>Ничего не найдено.<\/p>";return}n.forEach(n=>{const t=document.createElement("a");t.href=`/Guitars/Show/${n.id}`;t.className="product-card-box";const i=n.guitarImageFileNames&&n.guitarImageFileNames.length>0,r=i?`<img src="/img/${n.guitarImageFileNames[0]}" 
             alt="${n.guitarBrand} ${n.guitarModel}" 
             class="product-card-image" />`:`<img src="/img/noimage_detail.png" 
             alt="Нет фото ${n.guitarBrand} ${n.guitarModel}" 
             class="product-card-image" />`;t.innerHTML=`
                ${r}
                <div class="product-card-info">
                    <div>${n.guitarBrand} ${n.guitarModel}</div>
                    <strong>${n.guitarPrice.toLocaleString()} ₽</strong>
                    <p>Тип: ${n.guitarType}</p>
                    <p>Бренд: ${n.guitarBrand}</p>
                </div>`;c.appendChild(t)})}function yt(n){n<=1?nt.style.display="none":(nt.style.display="flex",ot.textContent=i,d.disabled=i===1,g.disabled=i===n,d.onclick=()=>{i>1&&(i--,s())},g.onclick=()=>{i<n&&(i++,s())})}const h=document.getElementById("filter-form"),c=document.getElementById("catalog-container"),d=document.getElementById("prev-page-btn"),g=document.getElementById("next-page-btn"),ot=document.getElementById("current-page"),nt=document.querySelector(".pagination"),a=document.getElementById("priceMin"),v=document.getElementById("priceMax"),st=document.getElementById("guitar-count"),ht=document.getElementById("reset-filters"),y=document.getElementById("page-size-select"),n=document.getElementById("price-slider-min"),r=document.getElementById("price-slider-max"),ct=document.getElementById("range-min-label"),lt=document.getElementById("range-max-label"),t=parseInt(n.min),u=parseInt(r.max),l=document.getElementById("search-input"),f=document.getElementById("live-search-results");let p;l.addEventListener("input",()=>{const n=l.value.trim();if(p&&clearTimeout(p),n.length<2){f.style.display="none";return}p=setTimeout(()=>{fetch(`/Guitars/LiveSearch?query=${encodeURIComponent(n)}`).then(n=>n.json()).then(n=>{at(n)}).catch(()=>{f.innerHTML="<p>Ошибка поиска<\/p>",f.style.display="block"})},30)});l.addEventListener("focus",()=>{const n=l.value.trim();n.length>=2&&(f.style.display="block")});document.addEventListener("click",n=>{f.contains(n.target)||l.contains(n.target)||(f.style.display="none")});const it=w(t,u);n.step=it;r.step=it;const e=document.createElement("p");e.style.color="red";e.style.marginTop="0px";e.style.display="none";e.textContent="Минимальная цена не может быть больше максимальной!";h.insertBefore(e,h.querySelector("button, input[type='submit']"));n.addEventListener("input",rt);r.addEventListener("input",ut);a.addEventListener("input",()=>{ft(),o()});v.addEventListener("input",()=>{ft(),o()});let i=1,et=parseInt(y.value);y.addEventListener("change",()=>{et=parseInt(y.value),i=1,s()});ht.addEventListener("click",()=>{h.reset(),n.value=t,r.value=u,rt(),ut(),i=1,s(),o()});h.addEventListener("submit",n=>{(n.preventDefault(),o())&&(i=1,s())});c.addEventListener("mouseover",n=>{const t=n.target.closest(".product-card-box");t&&(t.style.transform="scale(1.05)",t.style.boxShadow="0 6px 20px rgba(0, 0, 0, 0.2)",t.style.backgroundColor="rgba(0, 0, 0, 0.05)")});c.addEventListener("mouseout",n=>{const t=n.target.closest(".product-card-box");t&&(t.style.transform="scale(1)",t.style.boxShadow="",t.style.backgroundColor="")});const k=document.getElementById("back-to-top");k&&(window.addEventListener("scroll",()=>{k.style.display=window.scrollY>300?"block":"none"}),k.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}));s()});